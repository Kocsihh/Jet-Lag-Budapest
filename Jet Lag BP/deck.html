<!DOCTYPE html>
<html lang="hu">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jet Lag Budapest: Cost Edition</title>
    <link rel="stylesheet" href="deck.css">
</head>

<body>
    <a href="./index.html" class="home-btn" title="Vissza a men√ºbe">üè†</a>
    <h1>JET LAG: BUDAPEST</h1>
    <div class="stats" id="deck-stats">Pakli: 60/60</div>

    <div class="controls">
        <button id="btn1" onclick="drawChoice(1)">H√∫zz 1-et</button>
        <button id="btn2" onclick="drawChoice(2)">H√∫zz 2-t</button>
        <button id="btn3" onclick="drawChoice(3)">H√∫zz 3-at</button>
    </div>


    <div id="status-bar"></div>
    <div id="selection-area"></div>

    <div id="inventory-section">
        <h2 style="font-size: 1.1em; margin: 0 0 10px 0;">TARSOLY</h2>
        <div id="inventory-display"></div>
    </div>

    <script>
        const originalDeck = [
            // TIPUSOK: Id≈ë (Cost 0), √Åtok (Cost 1-2), Speci√°lis (Cost 1-2)
            // --- ID≈êK√ÅRTY√ÅK (20 db - Ingyenes) ---
            { nev: "Id≈ë +2p", tipus: "Id≈ë", cost: 0, leiras: "+2 perc eg√©r√∫t." },
            { nev: "Id≈ë +2p", tipus: "Id≈ë", cost: 0, leiras: "+2 perc eg√©r√∫t." },
            { nev: "Id≈ë +2p", tipus: "Id≈ë", cost: 0, leiras: "+2 perc eg√©r√∫t." },
            { nev: "Id≈ë +2p", tipus: "Id≈ë", cost: 0, leiras: "+2 perc eg√©r√∫t." },
            { nev: "Id≈ë +2p", tipus: "Id≈ë", cost: 0, leiras: "+2 perc eg√©r√∫t." },
            { nev: "Id≈ë +3p", tipus: "Id≈ë", cost: 0, leiras: "+3 perc eg√©r√∫t." },
            { nev: "Id≈ë +3p", tipus: "Id≈ë", cost: 0, leiras: "+3 perc eg√©r√∫t." },
            { nev: "Id≈ë +3p", tipus: "Id≈ë", cost: 0, leiras: "+3 perc eg√©r√∫t." },
            { nev: "Id≈ë +3p", tipus: "Id≈ë", cost: 0, leiras: "+3 perc eg√©r√∫t." },
            { nev: "Id≈ë +3p", tipus: "Id≈ë", cost: 0, leiras: "+3 perc eg√©r√∫t." },
            { nev: "Id≈ë +5p", tipus: "Id≈ë", cost: 0, leiras: "+5 perc eg√©r√∫t." },
            { nev: "Id≈ë +5p", tipus: "Id≈ë", cost: 0, leiras: "+5 perc eg√©r√∫t." },
            { nev: "Id≈ë +5p", tipus: "Id≈ë", cost: 0, leiras: "+5 perc eg√©r√∫t." },
            { nev: "Id≈ë +7p", tipus: "Id≈ë", cost: 0, leiras: "+7 perc eg√©r√∫t." },
            { nev: "Id≈ë +7p", tipus: "Id≈ë", cost: 0, leiras: "+7 perc eg√©r√∫t." },
            { nev: "Id≈ë +10p", tipus: "Id≈ë", cost: 0, leiras: "+10 perc eg√©r√∫t." },
            { nev: "Id≈ë +10p", tipus: "Id≈ë", cost: 0, leiras: "+10 perc eg√©r√∫t." },
            { nev: "Id≈ë +15p", tipus: "Id≈ë", cost: 0, leiras: "+15 perc eg√©r√∫t." },
            { nev: "Id≈ë +15p", tipus: "Id≈ë", cost: 0, leiras: "+15 perc eg√©r√∫t." },
            { nev: "Id≈ë +20p", tipus: "Id≈ë", cost: 0, leiras: "A J√°t√©kmester kegye." },
            { nev: "Id≈ë +5%", tipus: "Id≈ë", cost: 0, leiras: "Az addigi √∂sszes b√≥nusz id≈ët n√∂veli 5%-kal." },

            // 15 √°tok k√°rtya

            { nev: "Beragadt ajt√≥", tipus: "√Åtok", cost: 1, leiras: "Ajt√≥n √°thalad√°sn√°l (√©p√ºlet/j√°rm≈±) 2 kock√°val 7+ dob√°s kell. Ha nem siker√ºl: 5p v√°rakoz√°s √©s √∫jra am√≠g nem siker√ºl." },
            { nev: "K√°ty√∫-√°tok", tipus: "√Åtok", cost: 1, leiras: "Keressetek 3 k√°ty√∫t (min. 20cm) 3 k√ºl√∂nb√∂z≈ë utc√°ban (fot√≥!)." },
            { nev: "V√°lts√°gd√≠j lev√©l", tipus: "√Åtok", cost: 2, leiras: "A k√∂vetkez≈ë k√©rd√©st nyomtatott anyagb√≥l kiv√°gott bet≈±kb≈ël kell √∂sszerakni (min. 5 sz√≥)." },
            { nev: "Falatoz√≥na", tipus: "√Åtok", cost: 1, leiras: "Menjetek egy Falatoz√≥n√°ba, k√≥stoljatok valami √∫jat √©s mondjatok v√©lem√©nyt." },
            { nev: "Falatoz√≥na", tipus: "√Åtok", cost: 1, leiras: "Menjetek egy Falatoz√≥n√°ba, k√≥stoljatok valami √∫jat √©s mondjatok v√©lem√©nyt." },
            { nev: "Mer√©sz tipp", tipus: "√Åtok", cost: 2, leiras: "Huny√≥k tippelnek: ha eltal√°lj√°k, a b√∫v√≥ vall. Ha nem: 27p k√©nyszerpihen≈ë a huny√≥knak." },
            { nev: "ChatGPT-metr√≥", tipus: "√Åtok", cost: 2, leiras: "A ChatGPT mond egy random metr√≥meg√°ll√≥t, oda el kell utazni (√°tmehetsz rajta)." },
            { nev: "Vir√°gz√≥ otthon", tipus: "√Åtok", cost: 1, leiras: "A b√∫v√≥ z√≥n√°ja 50%-kal n≈ë. " },
            { nev: "Sz√≠vecske", tipus: "√Åtok", cost: 1, leiras: "Keressetek egy sz√≠vecske szimb√≥lumot a k√∂rny√©ken, miel≈ëtt k√©rdezhetn√©tek." },
            { nev: "C√°pa-√°tok", tipus: "√Åtok", cost: 2, leiras: "25 percig tilos meg√°llni (folyamatos gyalogl√°s)." },
            { nev: "Metr√≥-z√°r", tipus: "√Åtok", cost: 2, leiras: "30 percig tilos a metr√≥ haszn√°lata." },
            { nev: "P√°ratlan j√°ratok", tipus: "√Åtok", cost: 1, leiras: "30 percig csak p√°ratlan sz√°m√∫ j√°rattal k√∂zlekedhettek." },
            { nev: "P√°ros j√°ratok", tipus: "√Åtok", cost: 1, leiras: "30 percig csak p√°ros sz√°m√∫ j√°rattal k√∂zlekedhettek." },
            { nev: "Z√°szl√≥-vad√°sz", tipus: "√Åtok", cost: 1, leiras: "Tal√°ljatok magyar z√°szl√≥t. Fot√≥val bizony√≠tva." },
            { nev: "Sz√©chenyi Terv", tipus: "√Åtok", cost: 1, leiras: "Fot√≥zzatok EU-s t√°bl√°t." },
            { nev: "Blok√°d", tipus: "√Åtok", cost: 0, leiras: "K√∂vetkez≈ë metr√≥ megv√°r√°sa." },
            { nev: "Akaszt√≥fa", tipus: "√Åtok", cost: 1, leiras: "Gy≈ëzzetek akaszt√≥f√°ban a b√∫j√≥ ellen. Ha nem siker√ºlt: 10p v√°rakoz√°s." },
            { nev: "V√°g√°nyz√°r v1", tipus: "√Åtok", cost: 0, leiras: "M3-M1 vonal tiltva 15 percig." },
            { nev: "V√°g√°nyz√°r v2", tipus: "√Åtok", cost: 0, leiras: "M2-M4 vonal tiltva 15 percig." },
            { nev: "Zebra-f√≥bia", tipus: "√Åtok", cost: 1, leiras: "Felsz√≠nen tilos a zebra 30p-ig." },
            { nev: "Duna-z√°r", tipus: "√Åtok", cost: 1, leiras: "20p-ig tilos √°tkelni a foly√≥n." },
            { nev: "Apr√≥p√©nz", tipus: "√Åtok", cost: 1, leiras: "Keress egy 100-ast. (pl: automata)" },
            { nev: "Szobor-fot√≥", tipus: "√Åtok", cost: 1, leiras: "Fot√≥zz egy szobrot b√°rhol." },
            { nev: "BKK H√≠rek", tipus: "√Åtok", cost: 0, leiras: "Olvass fel egy kijelz≈ë-h√≠rt vide√≥ban." },
            { nev: "T√°v-dob√°s", tipus: "√Åtok", cost: 1, leiras: "Dobj egy 5-√∂s vagy nagyobb √©rt√©ket egy kock√°val √∫gy hogy legal√°bb 30 m√©ter messze dobod lol" },

            // --- SPECI√ÅLIS K√ÅRTY√ÅK (20 db) ---
            { nev: "V√©t√≥", tipus: "Speci√°lis", cost: 0, leiras: "K√©rd√©s t√∂rl√©se." },
            { nev: "V√©t√≥", tipus: "Speci√°lis", cost: 0, leiras: "K√©rd√©s t√∂rl√©se." },
            { nev: "Randomiz√°l√°s", tipus: "Speci√°lis", cost: 0, leiras: "Kocka d√∂nt a k√©rd√©sr≈ël." },
            { nev: "Randomiz√°l√°s", tipus: "Speci√°lis", cost: 0, leiras: "Kocka d√∂nt a k√©rd√©sr≈ël." },
            { nev: "M√°sol√°s", tipus: "Speci√°lis", cost: 0, leiras: "Egy k√°rtya m√°sol√°sa." },
            { nev: "√Åtsz√°ll√≥jegy", tipus: "Speci√°lis", cost: 0, leiras: "Tilos vonalv√°lt√°s 10p-ig." },
            { nev: "Ir√°nyv√°lt√≥", tipus: "Speci√°lis", cost: 0, leiras: "A H√∫ny√≥k azonnal sz√°lljanak le √©s menjenek vissza 2 meg√°ll√≥t, ha vonalon vannak." },
            { nev: "Szuper-V√©t√≥", tipus: "Speci√°lis", cost: 0, leiras: "K√©rd√©s + Huny√≥ k√©rd√©s kuka." },
            { nev: "Ki√ºr√ºlt agy", tipus: "Speci√°lis", cost: 1, leiras: "3 tiltott k√©rd√©s 1-1 kateg√≥ri√°n bel√ºl." }
            // 5db h√∫z√≥s speci√°lis k√°rtya 
        ];

        let currentDeck = [...originalDeck];
        let inventory = [];
        let drawnPool = [];

        // Cost payment state
        let isPaying = false;
        let targetIndex = -1;
        let selectedForDiscard = [];

        function updateStats() {
            document.getElementById('deck-stats').innerText = `Pakli: ${currentDeck.length} / 64`;
        }

        function drawChoice(count) {
            if (isPaying) return;
            if (currentDeck.length < count) { currentDeck = [...originalDeck]; }

            document.getElementById('btn2').disabled = true;
            document.getElementById('btn3').disabled = true;

            drawnPool = [];
            const area = document.getElementById('selection-area');
            area.innerHTML = '';

            for (let i = 0; i < count; i++) {
                let index = Math.floor(Math.random() * currentDeck.length);
                let card = currentDeck.splice(index, 1)[0];
                drawnPool.push(card);

                const cardEl = document.createElement('div');
                cardEl.className = 'card';
                cardEl.innerHTML = renderCardContent(card);
                cardEl.onclick = () => keepCard(i);
                area.appendChild(cardEl);
            }
            updateStats();
        }

        function renderCardContent(card) {
            let dots = "";
            for (let i = 0; i < card.cost; i++) dots += '<div class="cost-dot"></div>';
            return `
                <div class="cost-indicator">${dots}</div>
                <div class="type">${card.tipus}</div>
                <div class="name">${card.nev}</div>
                <div class="desc">${card.leiras}</div>
            `;
        }

        function keepCard(idx) {
            inventory.push(drawnPool[idx]);
            drawnPool = [];
            document.getElementById('selection-area').innerHTML = '';
            document.getElementById('btn2').disabled = false;
            document.getElementById('btn3').disabled = false;
            renderInventory();
        }

        function renderInventory() {
            const display = document.getElementById('inventory-display');
            display.innerHTML = '';
            inventory.forEach((card, index) => {
                const invCard = document.createElement('div');
                invCard.className = 'card inventory-card';
                if (isPaying && index === targetIndex) invCard.classList.add('paying');
                if (selectedForDiscard.includes(index)) invCard.classList.add('selected-to-discard');

                invCard.innerHTML = renderCardContent(card);
                invCard.onclick = () => handleInventoryClick(index);
                display.appendChild(invCard);
            });
        }

        function handleInventoryClick(index) {
            if (!isPaying) {
                startUsage(index);
            } else {
                handleDiscardSelection(index);
            }
        }

        function startUsage(index) {
            const card = inventory[index];
            if (card.cost === 0) {
                if (confirm(`Kij√°tszod: ${card.nev}?`)) {
                    inventory.splice(index, 1);
                    renderInventory();
                }
            } else {
                // Check if enough cards to pay
                if (inventory.length <= card.cost) {
                    alert("Nincs el√©g k√°rty√°d az inventory-ban a k√∂lts√©g kifizet√©s√©hez!");
                    return;
                }
                isPaying = true;
                targetIndex = index;
                selectedForDiscard = [];
                updateStatus(`FIZET√âS: V√°lassz ${card.cost} lapot az eldob√°shoz!`);
                renderInventory();
            }
        }

        function handleDiscardSelection(index) {
            if (index === targetIndex) {
                // Cancel payment
                isPaying = false;
                targetIndex = -1;
                selectedForDiscard = [];
                updateStatus("");
                renderInventory();
                return;
            }

            if (selectedForDiscard.includes(index)) {
                selectedForDiscard = selectedForDiscard.filter(i => i !== index);
            } else {
                if (selectedForDiscard.length < inventory[targetIndex].cost) {
                    selectedForDiscard.push(index);
                }
            }

            if (selectedForDiscard.length === inventory[targetIndex].cost) {
                finalizeUsage();
            } else {
                renderInventory();
            }
        }

        function finalizeUsage() {
            const cardName = inventory[targetIndex].nev;
            if (confirm(`Kifizeted a k√∂lts√©get √©s haszn√°lod a k√∂vetkez≈ët: ${cardName}?`)) {
                // Remove selected cards and the target card
                let indicesToRemove = [...selectedForDiscard, targetIndex].sort((a, b) => b - a);
                indicesToRemove.forEach(i => inventory.splice(i, 1));
            }
            isPaying = false;
            targetIndex = -1;
            selectedForDiscard = [];
            updateStatus("");
            renderInventory();
        }

        function updateStatus(msg) {
            const bar = document.getElementById('status-bar');
            if (msg) {
                bar.innerText = msg;
                bar.style.display = 'block';
            } else {
                bar.style.display = 'none';
            }
        }

        updateStats();
    </script>
</body>

</html>