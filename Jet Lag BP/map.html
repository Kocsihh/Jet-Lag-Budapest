<!DOCTYPE html>
<html lang="hu">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Budapest Radar & Hőmérő + Búvóhelyek</title>
    <script
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDMOAqGuk1x3mCk9_SeL98wY7g7pXi3sn0&libraries=geometry"></script>
    <style>
        body {
            margin: 0;
            font-family: 'Segoe UI', sans-serif;
            background: #111;
            color: white;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        #map {
            flex-grow: 1;
            width: 100%;
            background: #1a1a1a;
        }

        .controls {
            background: #1a1a1a;
            padding: 15px;
            display: flex;
            justify-content: center;
            gap: 8px;
            border-top: 1px solid #333;
            flex-wrap: wrap;
        }

        button {
            padding: 10px 15px;
            border: 1px solid #444;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            font-size: 11px;
            transition: all 0.2s;
            background: #2a2a2a;
            color: #eee;
            text-transform: uppercase;
        }

        button:hover {
            background: #3a3a3a;
            border-color: #666;
        }

        .btn-radar {
            background: #e64a19;
            border: none;
            color: white;
        }

        .btn-thermo {
            background: #1976d2;
            border: none;
            color: white;
        }

        .btn-hiders {
            background: #00838f;
            border: none;
            color: white;
        }

        /* Új gomb stílus */
        .btn-swap {
            background: #9c27b0;
            border: none;
            color: white;
            display: none;
        }

        .btn-toggle {
            background: #fbc02d;
            color: #000;
            border: none;
        }

        .btn-toggle.off {
            background: #444;
            color: #888;
        }

        .btn-reset {
            background: #d32f2f;
            border: none;
            color: white;
        }

        #status-bar {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            display: none;
            z-index: 1000;
            pointer-events: none;
        }
    </style>
</head>

<body>

    <div id="status-bar">Válassz egy pontot a térképen!</div>
    <div id="map"></div>

    <div class="controls">
        <button class="btn-toggle" id="tramBtn" onclick="toggleTrams()">Villamosok: BE</button>

        <!-- Radarok -->
        <button class="btn-radar" onclick="drawRadar(500)">R 500m</button>
        <button class="btn-radar" onclick="drawRadar(1000)">R 1km</button>
        <button class="btn-radar" onclick="promptCustomRadar()">R Egyéni</button>
        <!-- <button class="btn-radar" onclick="drawRadar(2000)">R 2km</button> -->
        <!-- Helyspórolás miatt kikommentelve, de visszarakható -->

        <!-- Hőmérők -->
        <button class="btn-thermo" onclick="startThermometer(1000)">Hő 1km</button>
        <button class="btn-thermo" onclick="startThermometer(5000)">Hő 5km</button>

        <!-- Új Funkció -->
        <button class="btn-hiders" onclick="togglePossibleHiders()">Megállók (500m)</button>

        <button class="btn-swap" id="swapBtn" onclick="swapColors()">Színcsere</button>

        <button class="btn-reset" onclick="clearAll()">Törlés</button>
    </div>

    <script>
        let map;
        let seekerMarker;
        let radarCircle = null;
        let tramLines = [];
        let tramsVisible = true;

        // Új változók a megállókhoz
        let hiderCircles = [];
        let hidersVisible = false;

        const bpCenter = { lat: 47.4979, lng: 19.0402 };

        let thermoState = {
            active: false,
            step: 0,
            radius: 0,
            pointA: null,
            pointB: null,
            markerA: null,
            markerB: null,
            guideCircle: null,
            zones: []
        };

        const metroData = [
            { name: "M1", color: "#ffcd00", path: [{ lat: 47.4967, lng: 19.0503 }, { lat: 47.49791, lng: 19.05396 }, { lat: 47.50049, lng: 19.05730 }, { lat: 47.5024, lng: 19.0594 }, { lat: 47.5042, lng: 19.0617 }, { lat: 47.5065, lng: 19.0645 }, { lat: 47.5085, lng: 19.0671 }, { lat: 47.5106, lng: 19.0700 }, { lat: 47.5147, lng: 19.0775 }, { lat: 47.51720, lng: 19.08080 }, { lat: 47.5194, lng: 19.0911 }] },
            { name: "M2", color: "#e41f18", path: [{ lat: 47.5003, lng: 19.0245 }, { lat: 47.5066, lng: 19.0253 }, { lat: 47.506389, lng: 19.038889 }, { lat: 47.50572, lng: 19.04498 }, { lat: 47.49766, lng: 19.05461 }, { lat: 47.4942, lng: 19.0601 }, { lat: 47.49716, lng: 19.07053 }, { lat: 47.50028, lng: 19.08167 }, { lat: 47.5000, lng: 19.1058 }, { lat: 47.501051, lng: 19.118839 }, { lat: 47.5028, lng: 19.1356 }] },
            { name: "M3", color: "#005ca5", path: [{ lat: 47.56033, lng: 19.09065 }, { lat: 47.55913, lng: 19.07981 }, { lat: 47.54871, lng: 19.07323 }, { lat: 47.5393922, lng: 19.0695 }, { lat: 47.53034, lng: 19.06583 }, { lat: 47.5225, lng: 19.0617 }, { lat: 47.51824, lng: 19.06055 }, { lat: 47.51139, lng: 19.05667 }, { lat: 47.50056, lng: 19.05358 }, { lat: 47.49791, lng: 19.05444 }, { lat: 47.493056, lng: 19.056111 }, { lat: 47.48987, lng: 19.06133 }, { lat: 47.48572, lng: 19.06938 }, { lat: 47.48265, lng: 19.07913 }, { lat: 47.47917, lng: 19.08944 }, { lat: 47.475556, lng: 19.098611 }, { lat: 47.47097, lng: 19.11130 }, { lat: 47.468629, lng: 19.117178 }, { lat: 47.46470, lng: 19.12640 }, { lat: 47.46333, lng: 19.14917 }] },
            { name: "M4", color: "#009540", path: [{ lat: 47.46499, lng: 19.022205 }, { lat: 47.46504, lng: 19.03291 }, { lat: 47.4741667, lng: 19.0458333 }, { lat: 47.477158, lng: 19.046778 }, { lat: 47.483934, lng: 19.053125 }, { lat: 47.487107, lng: 19.057481 }, { lat: 47.489644, lng: 19.061687 }, { lat: 47.492778, lng: 19.072222 }, { lat: 47.49580, lng: 19.07750 }, { lat: 47.50030, lng: 19.08172 }] }
        ];

        const tramData = [
            { name: "4-6", commonPath: [{ lat: 47.507153, lng: 19.023155 }, { lat: 47.508133, lng: 19.026750 }, { lat: 47.51089, lng: 19.03161 }, { lat: 47.51483, lng: 19.03929 }, { lat: 47.514700, lng: 19.043500 }, { lat: 47.51339, lng: 19.04743 }, { lat: 47.51050, lng: 19.05603 }, { lat: 47.505717, lng: 19.062549 }, { lat: 47.503084, lng: 19.065921 }, { lat: 47.50029, lng: 19.06909 }, { lat: 47.49610, lng: 19.07060 }, { lat: 47.492383, lng: 19.070928 }, { lat: 47.48999, lng: 19.07056 }, { lat: 47.486350, lng: 19.070192 }, { lat: 47.482751, lng: 19.068848 }, { lat: 47.48051, lng: 19.06714 }, { lat: 47.476773, lng: 19.058876 }], branch4: [{ lat: 47.47374783, lng: 19.05296317 }, { lat: 47.47406664, lng: 19.04682207 }], branch6: [{ lat: 47.47606, lng: 19.05378 }, { lat: 47.47756, lng: 19.04752 }] },
            {
                name: "1", commonPath: [
                    { "lat": 47.5487668, "lng": 19.0293717, "name": "Bécsi út / Vörösvári út" },
                    { "lat": 47.544915, "lng": 19.0347212, "name": "Óbudai rendelőintézet" },
                    { "lat": 47.5415559, "lng": 19.0399876, "name": "Flórián tér" },
                    { "lat": 47.5396294, "lng": 19.0451951, "name": "Szentlélek tér H" },
                    { "lat": 47.5363463, "lng": 19.0589357, "name": "Népfürdő utca / Árpád híd" },
                    { "lat": 47.5329813, "lng": 19.0661038, "name": "Göncz Árpád városközpont M" },
                    { "lat": 47.5300597, "lng": 19.0706795, "name": "Honvédkórház" },
                    { "lat": 47.5257963, "lng": 19.0774973, "name": "Lehel utca / Róbert Károly körút" },
                    { "lat": 47.5232561, "lng": 19.0814291, "name": "Vágány utca / Róbert Károly körút" },
                    { "lat": 47.5186671, "lng": 19.0885636, "name": "Kacsóh Pongrác út" },
                    { "lat": 47.5164235, "lng": 19.0918791, "name": "Erzsébet királyné útja, aluljáró" },
                    { "lat": 47.5135342, "lng": 19.0961055, "name": "Ajtósi Dürer sor" },
                    { "lat": 47.5109104, "lng": 19.0995615, "name": "Zugló vasútállomás" },
                    { "lat": 47.5067547, "lng": 19.1044403, "name": "Egressy út / Hungária körút" },
                    { "lat": 47.500385, "lng": 19.1081247, "name": "Puskás Ferenc Stadion M" },
                    { "lat": 47.4958347, "lng": 19.1090382, "name": "Hős utca" },
                    { "lat": 47.490764, "lng": 19.1088648, "name": "Hidegkuti Nándor Stadion" },
                    { "lat": 47.4857759, "lng": 19.1070467, "name": "Kőbányai út / Könyves Kálmán körút" },
                    { "lat": 47.4813983, "lng": 19.1031742, "name": "Vajda Péter utca" },
                    { "lat": 47.4758973, "lng": 19.0988621, "name": "Népliget M" },
                    { "lat": 47.4725099, "lng": 19.0956319, "name": "Albert Flórián út" },
                    { "lat": 47.4702263, "lng": 19.0885575, "name": "Ferencváros vasútállomás - Málenkij Robot emlékhely" },
                    { "lat": 47.4696228, "lng": 19.0837741, "name": "Mester utca / Könyves Kálmán körút" },
                    { "lat": 47.4687841, "lng": 19.0727767, "name": "Közvágóhíd H" },
                    { "lat": 47.4692119, "lng": 19.0597545, "name": "Infopark" },
                    { "lat": 47.4698143, "lng": 19.0536716, "name": "Budafoki út / Dombóvári út" },
                    { "lat": 47.4665602, "lng": 19.049538, "name": "Hauszmann Alajos utca / Szerémi út" },
                    { "lat": 47.4620694, "lng": 19.0482701, "name": "Hengermalom út / Szerémi út" },
                    { "lat": 47.4622567, "lng": 19.043347, "name": "Etele út / Fehérvári út" },
                    { "lat": 47.4636049, "lng": 19.0333096, "name": "Bikás park M" },
                    { "lat": 47.4640913, "lng": 19.0296236, "name": "Bártfai utca" },
                    { "lat": 47.4640348, "lng": 19.0231417, "name": "Kelenföld vasútállomás M" }
                ], branch4: [], branch6: []
            }
        ];

        const bpBoundaryCoords = [
            { lat: 47.613, lng: 19.053 }, { lat: 47.600, lng: 19.120 }, { lat: 47.585, lng: 19.160 },
            { lat: 47.560, lng: 19.240 }, { lat: 47.530, lng: 19.330 }, { lat: 47.490, lng: 19.345 },
            { lat: 47.435, lng: 19.260 }, { lat: 47.385, lng: 19.200 }, { lat: 47.350, lng: 19.160 },
            { lat: 47.365, lng: 19.040 }, { lat: 47.410, lng: 18.980 }, { lat: 47.445, lng: 18.915 },
            { lat: 47.510, lng: 18.930 }, { lat: 47.550, lng: 18.900 }, { lat: 47.590, lng: 18.960 },
            { lat: 47.613, lng: 19.053 }
        ];

        function initMap() {
            const stationOnlyStyle = [
                { "elementType": "geometry", "stylers": [{ "color": "#1d2c4d" }] },
                { "elementType": "labels.text.fill", "stylers": [{ "color": "#8ec3b9" }] },
                { "elementType": "labels.text.stroke", "stylers": [{ "color": "#1a3646" }] },
                { "featureType": "poi", "stylers": [{ "visibility": "off" }] },
                { "featureType": "transit.line", "stylers": [{ "visibility": "off" }] },
                { "featureType": "transit.station", "stylers": [{ "visibility": "on" }] },
                { "featureType": "road", "elementType": "geometry", "stylers": [{ "color": "#304a7d" }] },
                { "featureType": "water", "elementType": "geometry", "stylers": [{ "color": "#0e1626" }] }
            ];

            map = new google.maps.Map(document.getElementById("map"), {
                center: bpCenter,
                zoom: 13,
                styles: stationOnlyStyle,
                disableDefaultUI: true,
                zoomControl: true,
                clickableIcons: false
            });

            drawBudapestOutline();

            // Metrók
            metroData.forEach(line => {
                new google.maps.Polyline({
                    path: line.path, strokeColor: line.color, strokeOpacity: 0.9, strokeWeight: 6, map: map
                });
            });

            // Villamosok
            tramData.forEach(line => {
                let common = new google.maps.Polyline({ path: line.commonPath, strokeColor: "#ffeb3b", strokeOpacity: 0.6, strokeWeight: 3, map: map });
                tramLines.push(common);
                if (line.branch4.length) tramLines.push(new google.maps.Polyline({ path: line.commonPath.concat(line.branch4), strokeColor: "#fdd835", strokeOpacity: 0.6, strokeWeight: 3, map: map }));
                if (line.branch6.length) tramLines.push(new google.maps.Polyline({ path: line.commonPath.concat(line.branch6), strokeColor: "#ffeb3b", strokeOpacity: 0.6, strokeWeight: 3, map: map }));
            });

            seekerMarker = new google.maps.Marker({
                position: bpCenter,
                map: map,
                draggable: true,
                icon: {
                    path: google.maps.SymbolPath.CIRCLE,
                    scale: 10, fillColor: "#ff4500", fillOpacity: 1, strokeWeight: 2, strokeColor: "white"
                },
                label: { text: "HUNYÓ", color: "white", fontWeight: "bold", fontSize: "12px" }
            });

            seekerMarker.addListener('dragend', () => {
                saveState();
                if (radarCircle) drawRadar(radarCircle.getRadius());
            });

            map.addListener("click", (e) => {
                if (!thermoState.active) return;
                if (thermoState.step === 1) {
                    placePointA(e.latLng);
                } else if (thermoState.step === 2) {
                    calculateAndPlacePointB(e.latLng);
                }
            });
        }

        function drawBudapestOutline() {
            new google.maps.Polygon({
                paths: bpBoundaryCoords,
                strokeColor: "#ffffff",
                strokeOpacity: 0.3,
                strokeWeight: 2,
                fillColor: "#ffffff",
                fillOpacity: 0.03,
                map: map,
                clickable: false
            });
        }

        // --- ÚJ FUNKCIÓ: POSSIBLE HIDER LOCATIONS ---
        function togglePossibleHiders() {
            if (hidersVisible) {
                clearHiders();
            } else {
                drawHiders();
            }
        }

        function drawHiders() {
            const radius = 500;
            const style = {
                strokeColor: "#00BCD4",
                strokeOpacity: 0.6,
                strokeWeight: 1,
                fillColor: "#00BCD4",
                fillOpacity: 0.15,
                map: map,
                clickable: false
            };

            let points = [];
            metroData.forEach(line => {
                // Metró megállók (töréspontok) mind fontosak
                points.push(...line.path);
            });

            tramData.forEach(line => {
                // Villamosnál csak minden 3. pontot vesszük, ha túl sűrű (vagy csak a megállókat ha lennének)
                // Itt most egy egyszerű ritkítást alkalmazunk a teljesítményért
                const stride = line.commonPath.length > 20 ? 3 : 1;
                for (let i = 0; i < line.commonPath.length; i += stride) {
                    points.push(line.commonPath[i]);
                }
                if (line.branch4) points.push(...line.branch4);
                if (line.branch6) points.push(...line.branch6);
            });

            points.forEach(pt => {
                const circle = new google.maps.Circle({
                    center: pt,
                    radius: radius,
                    ...style
                });
                hiderCircles.push(circle);
            });

            hidersVisible = true;
        }

        function clearHiders() {
            hiderCircles.forEach(c => c.setMap(null));
            hiderCircles = [];
            hidersVisible = false;
        }

        // --- HŐMÉRŐ FUNKCIÓK ---

        function startThermometer(radius) {
            clearAll();
            thermoState.active = true;
            thermoState.radius = radius;
            thermoState.step = 1;
            updateStatus(`Kattints az INDULÓ pont (${radius / 1000} km) lerakásához!`);
            map.setOptions({ draggableCursor: 'crosshair' });
        }

        function placePointA(latLng) {
            thermoState.pointA = latLng;

            thermoState.markerA = new google.maps.Marker({
                position: latLng,
                map: map,
                label: { text: "A", color: "white", fontWeight: "bold" },
                icon: {
                    path: google.maps.SymbolPath.CIRCLE,
                    scale: 6, fillColor: "blue", fillOpacity: 1, strokeColor: "white", strokeWeight: 2
                }
            });

            thermoState.guideCircle = new google.maps.Circle({
                strokeColor: "#1976d2",
                strokeOpacity: 0.5,
                strokeWeight: 1,
                fillColor: "#1976d2",
                fillOpacity: 0.05,
                map: map,
                center: latLng,
                radius: thermoState.radius,
                clickable: false
            });

            thermoState.step = 2;
            updateStatus(`Kattints bárhova az IRÁNY megadásához!`);
        }

        function calculateAndPlacePointB(clickLatLng) {
            const heading = google.maps.geometry.spherical.computeHeading(thermoState.pointA, clickLatLng);
            const exactPointB = google.maps.geometry.spherical.computeOffset(thermoState.pointA, thermoState.radius, heading);
            thermoState.pointB = exactPointB;

            thermoState.markerB = new google.maps.Marker({
                position: exactPointB,
                map: map,
                label: { text: "B", color: "white", fontWeight: "bold" },
                icon: {
                    path: google.maps.SymbolPath.CIRCLE,
                    scale: 6, fillColor: "green", fillOpacity: 1, strokeColor: "white", strokeWeight: 2
                }
            });

            map.setOptions({ draggableCursor: null });
            thermoState.guideCircle.setMap(null);
            thermoState.active = false;
            thermoState.step = 0;
            updateStatus("");
            document.getElementById('swapBtn').style.display = 'block';
            drawTemperatureZones();
            saveState();
        }

        function drawTemperatureZones() {
            const A = thermoState.pointA;
            const B = thermoState.pointB;
            if (!A || !B) return;

            const midPoint = google.maps.geometry.spherical.interpolate(A, B, 0.5);
            const heading = google.maps.geometry.spherical.computeHeading(A, B);
            const headingRight = heading + 90;
            const headingLeft = heading - 90;
            const farDist = 15000; // Optimalizálva 50km-ről 15km-re

            const dividerRight = google.maps.geometry.spherical.computeOffset(midPoint, farDist, headingRight);
            const dividerLeft = google.maps.geometry.spherical.computeOffset(midPoint, farDist, headingLeft);

            const greenCornerRight = google.maps.geometry.spherical.computeOffset(dividerRight, farDist, heading);
            const greenCornerLeft = google.maps.geometry.spherical.computeOffset(dividerLeft, farDist, heading);

            const greenZone = new google.maps.Polygon({
                paths: [dividerLeft, dividerRight, greenCornerRight, greenCornerLeft],
                strokeColor: "#00FF00", strokeOpacity: 0, strokeWeight: 0,
                fillColor: "#00FF00", fillOpacity: 0.15, map: map, clickable: false
            });
            thermoState.zones.push(greenZone);

            const redCornerRight = google.maps.geometry.spherical.computeOffset(dividerRight, farDist, heading + 180);
            const redCornerLeft = google.maps.geometry.spherical.computeOffset(dividerLeft, farDist, heading + 180);

            const redZone = new google.maps.Polygon({
                paths: [dividerLeft, dividerRight, redCornerRight, redCornerLeft],
                strokeColor: "#FF0000", strokeOpacity: 0, strokeWeight: 0,
                fillColor: "#FF0000", fillOpacity: 0.15, map: map, clickable: false
            });
            thermoState.zones.push(redZone);

            const connector = new google.maps.Polyline({
                path: [A, B],
                strokeColor: "white", strokeOpacity: 0.8, strokeWeight: 2,
                icons: [{ icon: { path: google.maps.SymbolPath.FORWARD_CLOSED_ARROW }, offset: '100%' }],
                map: map
            });
            thermoState.zones.push(connector);
        }

        function swapColors() {
            thermoState.zones.forEach(overlay => {
                if (overlay instanceof google.maps.Polygon) {
                    const currentColor = overlay.get('fillColor');
                    if (currentColor === "#00FF00") {
                        overlay.setOptions({ fillColor: "#FF0000", strokeColor: "#FF0000" });
                    } else if (currentColor === "#FF0000") {
                        overlay.setOptions({ fillColor: "#00FF00", strokeColor: "#00FF00" });
                    }
                }
            });
            saveState();
        }

        // --- EGYÉB SEGÉDFUNKCIÓK ---

        function updateStatus(text) {
            const el = document.getElementById('status-bar');
            if (text) {
                el.innerText = text; el.style.display = 'block';
            } else {
                el.style.display = 'none';
            }
        }

        function toggleTrams() {
            tramsVisible = !tramsVisible;
            tramLines.forEach(line => line.setMap(tramsVisible ? map : null));
            document.getElementById('tramBtn').innerText = tramsVisible ? "Villamosok: BE" : "Villamosok: KI";
            document.getElementById('tramBtn').classList.toggle('off', !tramsVisible);
        }

        function promptCustomRadar() {
            const value = prompt("Add meg a radar sugarát (méterben):", "750");
            if (value && !isNaN(value)) {
                drawRadar(parseInt(value));
            }
        }

        function drawRadar(radius) {
            clearRadar();
            radarCircle = new google.maps.Circle({
                strokeColor: "#ff4500", strokeOpacity: 0.8, strokeWeight: 2,
                fillColor: "#ff4500", fillOpacity: 0.1,
                map: map, center: seekerMarker.getPosition(), radius: radius, clickable: false
            });
            map.panTo(seekerMarker.getPosition());
            saveState();
        }

        function clearRadar() {
            if (radarCircle) {
                radarCircle.setMap(null);
                radarCircle = null;
            }
            saveState();
        }

        function clearThermometer() {
            if (thermoState.markerA) thermoState.markerA.setMap(null);
            if (thermoState.markerB) thermoState.markerB.setMap(null);
            if (thermoState.guideCircle) thermoState.guideCircle.setMap(null);
            thermoState.zones.forEach(p => p.setMap(null));
            thermoState.zones = [];
            thermoState.active = false;
            thermoState.step = 0;
            thermoState.pointA = null;
            thermoState.pointB = null;
            updateStatus("");
            map.setOptions({ draggableCursor: null });
            document.getElementById('swapBtn').style.display = 'none';
            saveState();
        }

        function clearAll() {
            clearRadar();
            clearThermometer();
            clearHiders();
            localStorage.removeItem('jetLagState');
        }

        // --- PERSISTENCE ---

        function saveState() {
            const state = {
                seekerPos: { lat: seekerMarker.getPosition().lat(), lng: seekerMarker.getPosition().lng() },
                radarRadius: radarCircle ? radarCircle.getRadius() : null,
                thermo: {
                    pointA: thermoState.pointA ? { lat: thermoState.pointA.lat(), lng: thermoState.pointA.lng() } : null,
                    pointB: thermoState.pointB ? { lat: thermoState.pointB.lat(), lng: thermoState.pointB.lng() } : null,
                    isSwapped: thermoState.zones.length > 0 && thermoState.zones[0].get('fillColor') === "#FF0000" // Egyszerű csekk
                }
            };
            localStorage.setItem('jetLagState', JSON.stringify(state));
        }

        function loadState() {
            const saved = localStorage.getItem('jetLagState');
            if (!saved) return;
            const state = JSON.parse(saved);

            if (state.seekerPos) {
                seekerMarker.setPosition(state.seekerPos);
            }

            if (state.radarRadius) {
                drawRadar(state.radarRadius);
            }

            if (state.thermo && state.thermo.pointA && state.thermo.pointB) {
                thermoState.pointA = new google.maps.LatLng(state.thermo.pointA.lat, state.thermo.pointA.lng);
                thermoState.pointB = new google.maps.LatLng(state.thermo.pointB.lat, state.thermo.pointB.lng);

                // Re-render markers for A and B
                thermoState.markerA = new google.maps.Marker({
                    position: thermoState.pointA, map: map, label: { text: "A", color: "white" },
                    icon: { path: google.maps.SymbolPath.CIRCLE, scale: 6, fillColor: "blue", fillOpacity: 1, strokeColor: "white", strokeWeight: 2 }
                });
                thermoState.markerB = new google.maps.Marker({
                    position: thermoState.pointB, map: map, label: { text: "B", color: "white" },
                    icon: { path: google.maps.SymbolPath.CIRCLE, scale: 6, fillColor: "green", fillOpacity: 1, strokeColor: "white", strokeWeight: 2 }
                });

                drawTemperatureZones();
                if (state.thermo.isSwapped) swapColors();
                document.getElementById('swapBtn').style.display = 'block';
            }
        }

        window.onload = () => {
            initMap();
            setTimeout(loadState, 500); // Biztosítsuk, hogy a térkép betöltött
        };
    </script>
</body>

</html>